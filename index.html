<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>STEPS Decision Aid Tool</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-papNMzNnQn5iH+1G+FHu8SyuXHs6A1k+Ln7tK5qRo1l5eYm6Jzv+1pArJ7N4C9FfpRrmAgM3tYWd3FZ9jKz1Bw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>STEPS Decision Aid Tool</h1>
      <p>
        This tool helps decision makers in India plan and scale Field Epidemiology Training Programs (FETP) 
        by predicting programme uptake, performing cost–benefit analyses, 
        and evaluating willingness‐to‐pay for key attributes.
      </p>
      <hr class="intro-hr" />
    </header>

    <nav class="tabs" role="tablist">
      <button class="tablink active" role="tab" aria-selected="true" aria-controls="introTab" onclick="openTab('introTab', this)">
        <i class="fa-solid fa-info-circle"></i><span> Introduction</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="instructionsTab" onclick="openTab('instructionsTab', this)">
        <i class="fa-solid fa-circle-question"></i><span> Instructions</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="attributesTab" onclick="openTab('attributesTab', this)">
        <i class="fa-solid fa-list"></i><span> Attributes</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="inputsTab" onclick="openTab('inputsTab', this)">
        <i class="fa-solid fa-sliders"></i><span> Inputs</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="wtpTab" onclick="openTab('wtpTab', this)">
        <i class="fa-solid fa-chart-bar"></i><span> WTP Results</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="uptakeTab" onclick="openTab('uptakeTab', this)">
        <i class="fa-solid fa-chart-line"></i><span> Predicted Program Uptake</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="cbaTab" onclick="openTab('cbaTab', this)">
        <i class="fa-solid fa-calculator"></i><span> Costs &amp; Benefits</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="scenariosTab" onclick="openTab('scenariosTab', this)">
        <i class="fa-solid fa-folder-open"></i><span> Scenarios</span>
      </button>
    </nav>

    <!-- Introduction Tab -->
    <section id="introTab" class="tabcontent" tabindex="0" style="display: block;">
      <div class="card">
        <h2>Introduction</h2>
        <ul class="intro-list">
          <li><strong>Instructions</strong>: Step-by-step usage details.</li>
          <li><strong>Attributes</strong>: Four discrete (with references) plus two continuous attributes for FETP scaling.</li>
          <li><strong>WTP Results</strong>: Extra value for each non-ref discrete level plus +1 increments in continuous attributes. Now includes corrected script for tab interactivity.</li>
          <li><strong>Costs &amp; Benefits</strong>: QALY scenario (Low=0.01, Moderate=0.05, High=0.08), plus cost breakdown cards for educational context.</li>
        </ul>
      </div>
    </section>

    <!-- Instructions Tab -->
    <section id="instructionsTab" class="tabcontent" tabindex="0">
      <div class="card calculation-info">
        <h4>How to Use This Tool</h4>
        <hr class="intro-hr" />
        <ol class="instructions-list">
          <li>Check the <strong>Attributes</strong> tab for reference levels or continuous ranges. Hover over icons for detailed descriptions (0.75em tooltip font).</li>
          <li>In <strong>Inputs</strong>:
            <ul style="margin-left:1.5em; list-style-type:circle;">
              <li>Select non-reference radio buttons for Training, Delivery, Accreditation, and Location attributes.</li>
              <li>Adjust <em>Cohort Size</em> (slider 500–2000). The chosen value is displayed next to the slider.</li>
              <li>Adjust the <em>Cost</em> slider 0–250, which we map to \$60–\$1500 internally. E.g., 125 => about \$780. 
                  This addresses user preferences for cost from \$60 to \$1500 with 4 potential levels in the logit but a single slider for simplicity.</li>
            </ul>
          </li>
          <li>Click <strong>"Calculate &amp; View Results"</strong> to see a modal with the predicted uptake. The <strong>Predicted Program Uptake</strong> tab shows a doughnut chart. No random noise is used for repeated calculations of the same scenario.</li>
          <li>Check <strong>WTP Results</strong> to see each non-ref discrete level plus +1 increments in continuous attributes, with ±10% error bars.</li>
          <li>Under <strong>Costs &amp; Benefits</strong>, pick a QALY scenario (Low=0.01, Mod=0.05, High=0.08). A summary table and bar chart appear showing total cost, net benefit, QALYs, etc. 
              The cost breakdown is purely illustrative for educational context.</li>
          <li><strong>Scenarios</strong> can be saved and exported to PDF. Each scenario includes your attribute choices plus the predicted uptake and net benefit.</li>
        </ol>
      </div>
    </section>

    <!-- Attributes Tab -->
    <section id="attributesTab" class="tabcontent" tabindex="0">
      <h2>Key Attributes</h2>
      <div class="attributes-list">

        <!-- 1: Training Level -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <!-- Example SVG icon for demonstration -->
            <svg width="32" height="32" fill="#2980b9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
              <path d="M32 6L2 18l30 12 30-12L32 6zM2 28v4l28 11v10l-4 2v5l10 0v-5l-4-2v-10l28-11v-4l-28 11L2 28z"/>
            </svg>
            <div class="tooltip" role="tooltip" style="font-size:0.75em; background-color:#2e4053;">
              <strong>Reference: Advanced</strong> <br/>
              Non-reference levels are Frontline and Intermediate. 
              <br/><br/>
              <em>Training Level</em> determines the scope of applied epidemiologic skills, leadership tasks, and the typical seniority of participants in the FETP.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Training Level</h4>
            <p>Frontline, Intermediate, Advanced</p>
          </div>
        </div>

        <!-- 2: Delivery Method -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="32" height="32" fill="#8e44ad" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
              <path d="M10 20h44v24H10V20zM8 16v32h48V16H8zM12 52h36v4H12v-4z"/>
            </svg>
            <div class="tooltip" role="tooltip" style="font-size:0.75em; background-color:#2e4053;">
              <strong>Reference: Online</strong> <br/>
              Non-reference: In-Person, Hybrid. 
              <br/><br/>
              <em>Delivery Method</em> can influence how participants engage and practice hands-on skills. In-person fosters direct mentorship, while hybrid blends online convenience with some physical sessions.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Delivery Method</h4>
            <p>In-Person, Online, Hybrid</p>
          </div>
        </div>

        <!-- 3: Accreditation -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="32" height="32" fill="#27ae60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
              <path d="M32 6l18 10v32l-18 10-18-10V16L32 6z M30 14h4v20h-4z m0 24h4v4h-4z"/>
            </svg>
            <div class="tooltip" role="tooltip" style="font-size:0.75em; background-color:#2e4053;">
              <strong>Reference: None</strong><br/>
              Non-ref: National, International. 
              <br/><br/>
              <em>Accreditation</em> can formalize the FETP certificate or diploma. National accreditation aids local acceptance, while international accreditation can expand global recognition.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Accreditation</h4>
            <p>National, International, None</p>
          </div>
        </div>

        <!-- 4: Location -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="32" height="32" fill="#e67e22" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
              <path d="M32 8C23.18 8 16 15.18 16 24c0 4 3 9.52 6.3 14.42 3.19 4.72 6.82 9.25 9.7 12.2l.01.01c.6.63 1.58.63 2.18 0l.01-.01c2.88-2.95 6.51-7.48 9.7-12.2C45 33.52 48 28 48 24c0-8.82-7.18-16-16-16zm0 22c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"/>
            </svg>
            <div class="tooltip" role="tooltip" style="font-size:0.75em; background-color:#2e4053;">
              <strong>Reference: District-Level</strong><br/>
              Non-ref: State-Level, Regional Centers.
              <br/><br/>
              <em>Location</em> addresses the primary base of FETP activities. District-level focuses local issues; state or regional expansions can tackle broader population health.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Location</h4>
            <p>District-Level, State-Level, Regional Centers</p>
          </div>
        </div>

        <!-- 5: Cohort Size -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="32" height="32" fill="#3498db" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
              <circle cx="32" cy="32" r="14"/>
              <path d="M2 32h8m44 0h8m-30 30v-8m0-44V2m-8 6l-6 6m20-6l6 6"/>
            </svg>
            <div class="tooltip" role="tooltip" style="font-size:0.75em; background-color:#2e4053;">
              Range: 500–2000. 
              <br/><br/>
              <em>Cohort Size</em> influences the total number of participants in each FETP intake. Larger cohorts can strengthen the public health workforce but may need increased resources.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Cohort Size</h4>
            <p>Continuous slider: 500–2000</p>
          </div>
        </div>

        <!-- 6: Cost (0..250 => $60..$1500) -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="32" height="32" fill="#e74c3c" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
              <path d="M32 2C16.54 2 4 14.54 4 30s12.54 28 28 28 28-12.54 28-28S47.46 2 32 2zm2 44h-4v-4h4v4zm-2-8c-3.31 0-6-2.69-6-6h4c0 1.1.9 2 2 2s2-.9 2-2-.9-2-2-2c-3.31 0-6-2.69-6-6s2.69-6 6-6c2.21 0 4.15 1.2 5.19 3H36v4h-2.81A5.99 5.99 0 0132 28c-1.1 0-2 .9-2 2s.9 2 2 2c3.31 0 6 2.69 6 6s-2.69 6-6 6z"/>
            </svg>
            <div class="tooltip" role="tooltip" style="font-size:0.75em; background-color:#2e4053;">
              Slider [0..250] internally mapped to \$60..\$1500. 
              <br/><br/>
              This cost per participant reflects direct FETP expense for each trainee, influencing uptake and feasibility.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Cost per Participant</h4>
            <p>Slider [0..250] => \$60..\$1500 in the model</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Inputs Tab -->
    <section id="inputsTab" class="tabcontent" tabindex="0">
      <h2>Configure Your Scenario</h2>
      <div class="input-card">
        <h3>Programme Inputs</h3>
        <p>
          Pick non-reference levels for the discrete attributes, set <em>Cohort Size</em> 
          (500–2000), and adjust the <em>Cost</em> slider (0–250 => \$60–\$1500). 
          Then click <strong>Calculate &amp; View Results</strong> to get your predicted uptake.
        </p>
        <div class="form-grid">
          <!-- 1: Training Level (Ref=Advanced) -->
          <div class="input-summary-card">
            <h4>Training Level <span class="reference">[Ref: Advanced]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="training-level" value="Frontline" checked> Frontline</label>
              <label><input type="radio" name="training-level" value="Intermediate"> Intermediate</label>
            </div>
          </div>
          <!-- 2: Delivery Method (Ref=Online) -->
          <div class="input-summary-card">
            <h4>Delivery Method <span class="reference">[Ref: Online]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="delivery-method" value="In-Person" checked> In-Person</label>
              <label><input type="radio" name="delivery-method" value="Hybrid"> Hybrid</label>
            </div>
          </div>
          <!-- 3: Accreditation (Ref=None) -->
          <div class="input-summary-card">
            <h4>Accreditation <span class="reference">[Ref: None]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="accreditation" value="National" checked> National</label>
              <label><input type="radio" name="accreditation" value="International"> International</label>
            </div>
          </div>
          <!-- 4: Location (Ref=District-Level) -->
          <div class="input-summary-card">
            <h4>Location <span class="reference">[Ref: District-Level]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="location" value="State-Level" checked> State-Level</label>
              <label><input type="radio" name="location" value="Regional Centers"> Regional</label>
            </div>
          </div>
          <!-- 5: Cohort Size slider -->
          <div class="input-summary-card">
            <h4>Cohort Size</h4>
            <input type="range" class="form-control-range" id="cohort-size" min="500" max="2000" step="250" value="1000">
            <small id="cohort-size-value">1000</small>
          </div>
          <!-- 6: Cost slider (0..250 => 60..1500) -->
          <div class="input-summary-card">
            <h4>Cost per Participant (USD)</h4>
            <input type="range" class="form-control-range" id="costSliderUI" min="0" max="250" step="1" value="125">
            <small id="costValueUI">$60 (approx.)</small>
          </div>
        </div>
        <div class="buttons-row">
          <button type="button" class="btn btn-primary" id="view-results">
            Calculate &amp; View Results
          </button>
          <div id="calc-feedback" class="calc-feedback"></div>
        </div>
      </div>
    </section>

    <!-- Modal for Results -->
    <div id="resultsModal" class="modal">
      <div class="modal-content">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <h3>Calculation Results</h3>
        <div id="modal-results"></div>
      </div>
    </div>

    <!-- Predicted Program Uptake Tab -->
    <section id="uptakeTab" class="tabcontent" tabindex="0">
      <h2><i class="fa-solid fa-chart-line"></i> Predicted Program Uptake</h2>
      <div id="uptake-content">
        <div class="chart-box">
          <canvas id="uptakeChart"></canvas>
        </div>
        <div id="uptake-recommendation" class="recommendation"></div>
      </div>
    </section>

    <!-- WTP Results Tab -->
    <section id="wtpTab" class="tabcontent" tabindex="0">
      <div class="calculation-info">
        <h4><i class="fa-solid fa-chart-bar"></i> Willingness to Pay (WTP) Results</h4>
        <p>
          Each bar indicates extra value (USD) for a non-reference discrete level or a +1 increment
          in the continuous attributes. Error bars ~ ±10% of the displayed WTP.
        </p>
        <div class="chart-box">
          <canvas id="wtpChartMain"></canvas>
        </div>
      </div>
    </section>

    <!-- Costs & Benefits Tab -->
    <section id="cbaTab" class="tabcontent" tabindex="0">
      <div id="cba-content" class="calculation-info">
        <h4><i class="fa-solid fa-calculator"></i> Costs &amp; Benefits Analysis</h4>
        <p>
          QALY Gains: Low=0.01, Moderate=0.05, High=0.08 for an India context. Gains × \$50,000 => monetized benefits.
        </p>
        <div class="qaly-selector">
          <label for="qalySelect">Select QALY Gain Scenario:</label>
          <select id="qalySelect" onchange="renderCostsBenefits()">
            <option value="low">Low (0.01 QALYs)</option>
            <option value="moderate" selected>Moderate (0.05 QALYs)</option>
            <option value="high">High (0.08 QALYs)</option>
          </select>
        </div>
        <div class="dynamic-summary" id="cba-summary">
          <!-- cost & benefit summary from script -->
        </div>
        <div class="chart-box">
          <canvas id="cbaChart"></canvas>
        </div>
        <div class="detailed-info">
          <h4>Detailed Cost Components</h4>
          <p>
            Illustrative fixed/variable costs. Actual figures differ by location and scale.
          </p>
          <div class="cost-cards">
            <div class="cost-card">
              <h4><i class="fa-solid fa-newspaper"></i> Local Press Ads</h4>
              <p><strong>Unit Cost:</strong> $1,500</p>
              <p><strong>Quantity:</strong> 2</p>
              <p><strong>Total:</strong> $3,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-print"></i> Printing of Leaflets</h4>
              <p><strong>Unit Cost:</strong> $0.12</p>
              <p><strong>Quantity:</strong> 10,000</p>
              <p><strong>Total:</strong> $1,200</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-envelope"></i> Postage of Leaflets</h4>
              <p><strong>Unit Cost:</strong> $0.15</p>
              <p><strong>Quantity:</strong> 10,000</p>
              <p><strong>Total:</strong> $1,500</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-user"></i> Administrative Personnel</h4>
              <p><strong>Unit Cost:</strong> $50</p>
              <p><strong>Quantity:</strong> 10</p>
              <p><strong>Total:</strong> $500</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-chalkboard-teacher"></i> Trainer Cost</h4>
              <p><strong>Unit Cost:</strong> $223.86</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $22,386</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-percent"></i> On-Costs (30%)</h4>
              <p><strong>Unit Cost:</strong> $44.77</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $4,477</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-user-tie"></i> Facilitator Salaries</h4>
              <p><strong>Unit Cost:</strong> $100</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $10,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-box"></i> Material Costs</h4>
              <p><strong>Unit Cost:</strong> $50</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $5,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-building"></i> Venue Hire</h4>
              <p><strong>Unit Cost:</strong> $15</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $1,500</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-clock"></i> Session Time Cost</h4>
              <p><strong>Unit Cost:</strong> $20</p>
              <p><strong>Quantity:</strong> 250</p>
              <p><strong>Total:</strong> $5,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-road"></i> Travel Costs</h4>
              <p><strong>Unit Cost:</strong> $10</p>
              <p><strong>Quantity:</strong> 250</p>
              <p><strong>Total:</strong> $2,500</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Scenarios Tab -->
    <section id="scenariosTab" class="tabcontent" tabindex="0">
      <div class="calculation-info">
        <h4>Saved Scenarios</h4>
        <p>
          Each scenario shows your chosen attribute levels, plus the predicted uptake and net benefit.
        </p>
        <div class="buttons-row">
          <button class="btn btn-info" id="save-scenario">Save Current Scenario</button>
          <button class="btn btn-secondary" id="export-pdf">Export Scenarios to PDF</button>
        </div>
        <div class="scenario-list" id="saved-scenarios-list">
          <!-- scenario items injected by script.js -->
        </div>
      </div>
    </section>

    <footer>
      <p>
        &copy; 2025 STEPS. All Rights Reserved.<br />
        Mesfin Genie, Newcastle Business School, University of Newcastle, Australia<br />
        <strong>Support:</strong> <a href="mailto:mesfin.genie@newcastle.edu.au">mesfin.genie@newcastle.edu.au</a>
      </p>
    </footer>
  </div>

  <!-- Modal for Results -->
  <div id="resultsModal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeModal()">&times;</span>
      <h3>Calculation Results</h3>
      <div id="modal-results"></div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
