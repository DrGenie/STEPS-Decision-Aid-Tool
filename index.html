<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>STEPS Decision Aid Tool</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-papNMzNnQn5iH+1G+FHu8SyuXHs6A1k+Ln7tK5qRo1l5eYm6Jzv+1pArJ7N4C9FfpRrmAgM3tYWd3FZ9jKz1Bw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>STEPS Decision Aid Tool</h1>
      <p>
        This tool supports decision makers in planning and scaling Field Epidemiology Training Programs (FETP) by predicting programme uptake, 
        performing cost–benefit analyses, and evaluating willingness‐to‐pay (WTP) for six key attributes (all in USD).
      </p>
      <hr class="intro-hr" />
    </header>

    <nav class="tabs" role="tablist">
      <button class="tablink active" role="tab" aria-selected="true" aria-controls="introTab" onclick="openTab('introTab', this)">
        <i class="fa-solid fa-info-circle"></i><span> Introduction</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="instructionsTab" onclick="openTab('instructionsTab', this)">
        <i class="fa-solid fa-circle-question"></i><span> Instructions</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="attributesTab" onclick="openTab('attributesTab', this)">
        <i class="fa-solid fa-list"></i><span> Attributes</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="inputsTab" onclick="openTab('inputsTab', this)">
        <i class="fa-solid fa-sliders"></i><span> Inputs</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="wtpTab" onclick="openTab('wtpTab', this)">
        <i class="fa-solid fa-chart-bar"></i><span> WTP Results</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="uptakeTab" onclick="openTab('uptakeTab', this)">
        <i class="fa-solid fa-chart-line"></i><span> Predicted Program Uptake</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="cbaTab" onclick="openTab('cbaTab', this)">
        <i class="fa-solid fa-calculator"></i><span> Costs &amp; Benefits</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="scenariosTab" onclick="openTab('scenariosTab', this)">
        <i class="fa-solid fa-folder-open"></i><span> Scenarios</span>
      </button>
    </nav>

    <!-- Introduction Tab -->
    <section id="introTab" class="tabcontent" tabindex="0" style="display: block;">
      <div class="card">
        <h2>Introduction</h2>
        <ul class="intro-list">
          <li><strong>Instructions</strong>: Step-by-step usage guide.</li>
          <li><strong>Attributes</strong>: Shows four discrete (with references) plus two continuous (Cohort Size, Cost from $60–$1500). Icons & smaller tooltips.</li>
          <li><strong>Inputs</strong>: Non-reference radio buttons for discrete; a 0–250 slider for cost, linearly mapped to $60–$1500.</li>
          <li><strong>WTP Results</strong>: Extra value (USD) for each discrete non-ref level plus +1 increments in Cohort Size & Cost. Font-size is smaller for tooltips. 
          </li>
          <li><strong>Predicted Program Uptake</strong>: A logit-based model estimates uptake, displayed in a doughnut chart with recommendations.</li>
          <li><strong>Costs &amp; Benefits</strong>: QALY scenario (Low=0.01, Mod=0.05, High=0.08), a summary table, bar chart, and cost breakdown cards.</li>
          <li><strong>Scenarios</strong>: Save, load, or export multiple configurations to PDF.</li>
        </ul>
      </div>
    </section>

    <!-- Instructions Tab -->
    <section id="instructionsTab" class="tabcontent" tabindex="0">
      <div class="card calculation-info">
        <h4>How to Use This Tool</h4>
        <hr class="intro-hr" />
        <ol class="instructions-list">
          <li>Visit <strong>Attributes</strong> to see each attribute’s reference level or continuous range, with icons and 0.8em font-size tooltips.</li>
          <li>In <strong>Inputs</strong>, select only non-reference levels for discrete attributes. For Cost, we have a slider from <strong>0 to 250</strong>, mapped to $60–$1500 internally. For instance, a slider of 125 would be $60 + (125*(1440/250)) = ~\$780. 
          Cohort Size is 500–2000 from that slider directly.</li>
          <li>Click <strong>“Calculate &amp; View Results”</strong> to see predicted uptake. The <strong>Predicted Program Uptake</strong> tab shows a doughnut chart with no random noise if you recalculate the same scenario.</li>
          <li>In <strong>WTP Results</strong>, each discrete non-ref level plus a +1 increment in Cohort Size & Cost are displayed with approximate standard errors (±10%).</li>
          <li>Under <strong>Costs &amp; Benefits</strong>, pick a QALY scenario (Low=0.01, Mod=0.05, High=0.08 for India). The dynamic summary table and bar chart show total cost, net benefit, QALYs, and monetized benefits. 
          Educational text clarifies cost components: local press ads, printing, trainer cost, etc.</li>
          <li><strong>Scenarios</strong>: Save your configuration or export them all in PDF. Each scenario includes user inputs plus predicted uptake and net benefit for easy comparison.</li>
        </ol>
      </div>
    </section>

    <!-- Attributes Tab -->
    <section id="attributesTab" class="tabcontent" tabindex="0">
      <h2>Key Attributes</h2>
      <div class="attributes-list">
        <!-- 1: Training Level -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <i class="fa-solid fa-user-graduate" style="color:#2980b9;font-size:1.7em;"></i>
            <div class="tooltip" role="tooltip" style="font-size:0.8em;">
              <strong>Reference:</strong> Advanced<br/>
              Non-ref: Frontline, Intermediate
            </div>
          </div>
          <div class="attribute-content">
            <h4>Training Level</h4>
            <p>Frontline, Intermediate, Advanced</p>
          </div>
        </div>
        <!-- 2: Delivery Method -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <i class="fa-solid fa-laptop-house" style="color:#8e44ad;font-size:1.7em;"></i>
            <div class="tooltip" role="tooltip" style="font-size:0.8em;">
              <strong>Reference:</strong> Online<br/>
              Non-ref: In-Person, Hybrid
            </div>
          </div>
          <div class="attribute-content">
            <h4>Delivery Method</h4>
            <p>In-Person, Online, Hybrid</p>
          </div>
        </div>
        <!-- 3: Accreditation -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <i class="fa-solid fa-certificate" style="color:#27ae60;font-size:1.7em;"></i>
            <div class="tooltip" role="tooltip" style="font-size:0.8em;">
              <strong>Reference:</strong> None<br/>
              Non-ref: National, International
            </div>
          </div>
          <div class="attribute-content">
            <h4>Accreditation</h4>
            <p>National, International, None</p>
          </div>
        </div>
        <!-- 4: Location -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <i class="fa-solid fa-location-dot" style="color:#e67e22;font-size:1.7em;"></i>
            <div class="tooltip" role="tooltip" style="font-size:0.8em;">
              <strong>Reference:</strong> District-Level<br/>
              Non-ref: State-Level, Regional
            </div>
          </div>
          <div class="attribute-content">
            <h4>Location</h4>
            <p>District-Level, State-Level, Regional Centers</p>
          </div>
        </div>
        <!-- 5: Cohort Size -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <i class="fa-solid fa-users-line" style="color:#3498db;font-size:1.7em;"></i>
            <div class="tooltip" role="tooltip" style="font-size:0.8em;">
              Range: 500–2000
            </div>
          </div>
          <div class="attribute-content">
            <h4>Cohort Size</h4>
            <p>Continuous slider (Inputs tab), no baseline displayed.</p>
          </div>
        </div>
        <!-- 6: Cost (USD) from $60 to $1500 -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <i class="fa-solid fa-money-bill-wave" style="color:#e74c3c;font-size:1.7em;"></i>
            <div class="tooltip" role="tooltip" style="font-size:0.8em;">
              Internally $60–$1500 with 4 levels for logit. 
              Mapped via slider 0–250 in the Inputs tab.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Cost per Participant (USD)</h4>
            <p>Slider in 0–250, linearly mapped to $60–$1500 for the model.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Inputs Tab -->
    <section id="inputsTab" class="tabcontent" tabindex="0">
      <h2>Configure Your Scenario</h2>
      <div class="input-card">
        <h3>Programme Inputs</h3>
        <p>Select non-reference levels for discrete attributes. For cost, the slider 0–250 => $60–$1500 internally. 
        For example, 125 => about $780. Cohort Size is from 500–2000 directly.</p>
        <div class="form-grid">
          <!-- 1: Training Level -->
          <div class="input-summary-card">
            <h4>Training Level <span class="reference">[Ref: Advanced]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="training-level" value="Frontline" checked> Frontline</label>
              <label><input type="radio" name="training-level" value="Intermediate"> Intermediate</label>
            </div>
          </div>
          <!-- 2: Delivery Method -->
          <div class="input-summary-card">
            <h4>Delivery Method <span class="reference">[Ref: Online]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="delivery-method" value="In-Person" checked> In-Person</label>
              <label><input type="radio" name="delivery-method" value="Hybrid"> Hybrid</label>
            </div>
          </div>
          <!-- 3: Accreditation -->
          <div class="input-summary-card">
            <h4>Accreditation <span class="reference">[Ref: None]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="accreditation" value="National" checked> National</label>
              <label><input type="radio" name="accreditation" value="International"> International</label>
            </div>
          </div>
          <!-- 4: Location -->
          <div class="input-summary-card">
            <h4>Location <span class="reference">[Ref: District-Level]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="location" value="State-Level" checked> State-Level</label>
              <label><input type="radio" name="location" value="Regional Centers"> Regional</label>
            </div>
          </div>
          <!-- 5: Cohort Size slider -->
          <div class="input-summary-card">
            <h4>Cohort Size</h4>
            <input type="range" class="form-control-range" id="cohort-size" min="500" max="2000" step="250" value="1000">
            <small id="cohort-size-value">1000</small>
          </div>
          <!-- 6: Cost slider (0->250 => $60->1500) -->
          <div class="input-summary-card">
            <h4>Cost per Participant (USD)</h4>
            <input type="range" class="form-control-range" id="costSliderUI" min="0" max="250" step="1" value="125">
            <small id="costValueUI">$780 (approx.)</small>
          </div>
        </div>
        <div class="buttons-row">
          <button type="button" class="btn btn-primary" id="view-results">
            Calculate &amp; View Results
          </button>
          <div id="calc-feedback" class="calc-feedback"></div>
        </div>
      </div>
    </section>

    <!-- Modal for Results -->
    <div id="resultsModal" class="modal">
      <div class="modal-content">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <h3>Calculation Results</h3>
        <div id="modal-results"></div>
      </div>
    </div>

    <!-- Predicted Program Uptake Tab -->
    <section id="uptakeTab" class="tabcontent" tabindex="0">
      <h2>Predicted Program Uptake</h2>
      <div id="uptake-content">
        <div class="chart-box">
          <canvas id="uptakeChart"></canvas>
        </div>
        <div id="uptake-recommendation" class="recommendation"></div>
      </div>
    </section>

    <!-- WTP Results Tab -->
    <section id="wtpTab" class="tabcontent" tabindex="0">
      <div class="calculation-info">
        <h4>Willingness to Pay (WTP) Results</h4>
        <p>
          The bar chart below shows how much more or less (in USD) stakeholders value each non-reference attribute level and a +1 increment in continuous attributes, compared to references.  
          Error bars reflect ±10% standard error.
        </p>
        <div class="chart-box">
          <canvas id="wtpChartMain"></canvas>
        </div>
      </div>
    </section>

    <!-- Costs & Benefits Tab -->
    <section id="cbaTab" class="tabcontent" tabindex="0">
      <div id="cba-content" class="calculation-info">
        <h4>Costs &amp; Benefits Analysis</h4>
        <p>
          Total costs = (Cohort Size × Training Cost). Benefits are estimated from QALY gains (Low=0.01, Mod=0.05, High=0.08) × $50,000. Adjust the scenario in <strong>Inputs</strong> and revisit this tab or change QALY scenario below:
        </p>
        <div class="qaly-selector">
          <label for="qalySelect">Select QALY Gain Scenario:</label>
          <select id="qalySelect" onchange="renderCostsBenefits()">
            <option value="low">Low (0.01 QALYs)</option>
            <option value="moderate" selected>Moderate (0.05 QALYs)</option>
            <option value="high">High (0.08 QALYs)</option>
          </select>
        </div>
        <div class="dynamic-summary" id="cba-summary">
          <!-- cost & benefit summary from script -->
        </div>
        <div class="chart-box">
          <canvas id="cbaChart"></canvas>
        </div>
        <div class="detailed-info">
          <h4>Detailed Cost Components (Illustrative)</h4>
          <p>
            The table below shows typical fixed and variable costs for running an FETP. 
            Actual figures may vary in different settings.
          </p>
          <div class="cost-cards">
            <div class="cost-card">
              <h4><i class="fa-solid fa-newspaper"></i> Local Press Ads</h4>
              <p><strong>Unit Cost:</strong> $1,500</p>
              <p><strong>Quantity:</strong> 2</p>
              <p><strong>Total:</strong> $3,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-print"></i> Printing of Leaflets</h4>
              <p><strong>Unit Cost:</strong> $0.12</p>
              <p><strong>Quantity:</strong> 10,000</p>
              <p><strong>Total:</strong> $1,200</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-envelope"></i> Postage of Leaflets</h4>
              <p><strong>Unit Cost:</strong> $0.15</p>
              <p><strong>Quantity:</strong> 10,000</p>
              <p><strong>Total:</strong> $1,500</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-user"></i> Administrative Personnel</h4>
              <p><strong>Unit Cost:</strong> $50</p>
              <p><strong>Quantity:</strong> 10</p>
              <p><strong>Total:</strong> $500</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-chalkboard-teacher"></i> Trainer Cost (5-hour sessions)</h4>
              <p><strong>Unit Cost:</strong> $223.86</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $22,386</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-percent"></i> On-Costs (30%)</h4>
              <p><strong>Unit Cost:</strong> $44.77</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $4,477</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-user-tie"></i> Facilitator Salaries</h4>
              <p><strong>Unit Cost:</strong> $100</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $10,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-box"></i> Material Costs</h4>
              <p><strong>Unit Cost:</strong> $50</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $5,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-building"></i> Venue Hire</h4>
              <p><strong>Unit Cost:</strong> $15</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $1,500</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-clock"></i> Session Time Cost</h4>
              <p><strong>Unit Cost:</strong> $20</p>
              <p><strong>Quantity:</strong> 250</p>
              <p><strong>Total:</strong> $5,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-road"></i> Travel Costs</h4>
              <p><strong>Unit Cost:</strong> $10</p>
              <p><strong>Quantity:</strong> 250</p>
              <p><strong>Total:</strong> $2,500</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Scenarios Tab -->
    <section id="scenariosTab" class="tabcontent" tabindex="0">
      <div class="calculation-info">
        <h4>Saved Scenarios</h4>
        <p>
          View or export your saved scenarios, each with predicted uptake and net benefit. 
        </p>
        <div class="buttons-row">
          <button class="btn btn-info" id="save-scenario">Save Current Scenario</button>
          <button class="btn btn-secondary" id="export-pdf">Export Scenarios to PDF</button>
        </div>
        <div class="scenario-list" id="saved-scenarios-list">
          <!-- scenario items from script.js -->
        </div>
      </div>
    </section>

    <footer>
      <p>
        &copy; 2025 STEPS. All Rights Reserved.<br />
        Mesfin Genie, Newcastle Business School, University of Newcastle, Australia<br />
        <strong>Support:</strong> <a href="mailto:mesfin.genie@newcastle.edu.au">mesfin.genie@newcastle.edu.au</a>
      </p>
    </footer>
  </div>

  <!-- Modal for Results -->
  <div id="resultsModal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeModal()">&times;</span>
      <h3>Calculation Results</h3>
      <div id="modal-results"></div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
