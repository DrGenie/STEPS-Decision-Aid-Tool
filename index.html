<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FETP Decision Aid Tool</title>
  <link rel="stylesheet" href="styles.css"/>
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-papNMzNnQn5h+1G+FHu8SyuXHs6A1k+Ln7tK5qRo1l5eYm6Jzv+1pArJ7N4C9FfpRrmAgM3tYWd3FZ9jKz1Bw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"/>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<div class="container">
  <header>
    <h1>FETP Decision Aid Tool</h1>
    <p>
      This tool helps decision-makers plan and scale Field Epidemiology Training Programs (FETP) by predicting programme uptake, 
      performing cost–benefit analyses, and evaluating willingness–to–pay (WTP) for key attributes.
    </p>
  </header>

  <nav class="tabs" role="tablist">
    <button class="tablink active" data-tab="introTab" aria-selected="true">
      <i class="fa-solid fa-info-circle"></i><span> Introduction</span>
    </button>
    <button class="tablink" data-tab="instructionsTab" aria-selected="false">
      <i class="fa-solid fa-circle-question"></i><span> Instructions</span>
    </button>
    <button class="tablink" data-tab="attributesTab" aria-selected="false">
      <i class="fa-solid fa-list"></i><span> Attributes</span>
    </button>
    <button class="tablink" data-tab="inputsTab" aria-selected="false">
      <i class="fa-solid fa-sliders"></i><span> Inputs</span>
    </button>
    <button class="tablink" data-tab="wtpTab" aria-selected="false">
      <i class="fa-solid fa-chart-bar"></i><span> WTP Results</span>
    </button>
    <button class="tablink" data-tab="probTab" aria-selected="false">
      <i class="fa-solid fa-chart-pie"></i><span> Predicted Programme Uptake</span>
    </button>
    <button class="tablink" data-tab="costsTab" aria-selected="false">
      <i class="fa-solid fa-calculator"></i><span> Costs &amp; Benefits</span>
    </button>
    <button class="tablink" data-tab="scenariosTab" aria-selected="false">
      <i class="fa-solid fa-folder-open"></i><span> Saved Scenarios</span>
    </button>
  </nav>

  <!-- Introduction Tab -->
  <section id="introTab" class="tabcontent" tabindex="0" style="display: block;">
    <div class="intro-box">
      <p>
        In many countries, Field Epidemiology Training Programs (FETPs) are essential for rapidly detecting 
        and responding to public health threats. This decision aid uses discrete choice experiment (DCE) estimates 
        to predict uptake probabilities, enabling data-driven decisions on how best to configure FETP attributes.
      </p>
      <ul>
        <li><strong>Instructions</strong> – Step-by-step guide to using the tool.</li>
        <li><strong>Attributes</strong> – Learn about six key features of FETP training (hover icons for reference levels).</li>
        <li><strong>Inputs</strong> – Configure your scenario’s cost, training level, accreditation, location, etc.</li>
        <li><strong>WTP Results</strong> – Inspect willingness-to-pay (USD) for each attribute from the DCE.</li>
        <li><strong>Predicted Programme Uptake</strong> – View the predicted probability of uptake based on your scenario.</li>
        <li><strong>Costs &amp; Benefits</strong> – Explore cost components and QALY-based benefits, with interactive toggles for detail.</li>
        <li><strong>Saved Scenarios</strong> – Save multiple configurations, compare them, or export to PDF.</li>
      </ul>
    </div>
  </section>

  <!-- Instructions Tab -->
  <section id="instructionsTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>How to Use This Tool</h4>
      <ol>
        <li style="margin-left: 20px;">Check <strong>Attributes</strong> for reference levels. Hover icons to see descriptions.</li>
        <li style="margin-left: 20px;">In <strong>Inputs</strong>, pick a non-reference training level, a location, an accreditation, 
          and a delivery method. Also set cost and cohort size. Then click “Calculate &amp; View Results.” If any 
          mandatory field is missing, the tool will alert you and stop.</li>
        <li style="margin-left: 20px;">Go to <strong>Predicted Programme Uptake</strong> for a doughnut chart 
          or <strong>Costs &amp; Benefits</strong> for an economic summary.</li>
        <li style="margin-left: 20px;">See <strong>WTP Results</strong> for a bar chart showing willingness-to-pay 
          per attribute level with error bars. If negative, that level discourages uptake.</li>
        <li style="margin-left: 20px;">Save any scenario in <strong>Saved Scenarios</strong> then export all to PDF if needed.</li>
      </ol>
    </div>
  </section>

  <!-- Attributes Tab -->
  <section id="attributesTab" class="tabcontent" tabindex="0">
    <h2>FETP Key Attributes</h2>
    <div class="attributes-list">

      <!-- Cost per Participant -->
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon">
          <svg width="24" height="24" fill="#2980b9" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#2980b9" stroke-width="2" fill="none"/>
            <path d="M10 15l-3-3 1.4-1.4 1.6 1.6L15 7l1.4 1.4-6.4 6.4z" fill="#2980b9"/>
          </svg>
          <div class="tooltip" role="tooltip">
            <strong>Reference: Lower cost</strong><br/>
            The out-of-pocket cost (USD) per participant. Higher cost may reduce uptake significantly.
          </div>
        </div>
        <div class="attribute-content">
          <h4>Cost per Participant</h4>
          <p>Ranging from cheaper to more expensive training.</p>
        </div>
      </div>

      <!-- Delivery Method -->
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon">
          <svg width="24" height="24" fill="#e67e22" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#e67e22" stroke-width="2" fill="none"/>
            <path d="M12 4a8 8 0 0 1 0 16 8 8 0 0 1 0-16z" fill="#e67e22"/>
          </svg>
          <div class="tooltip" role="tooltip">
            <strong>Reference: Online</strong><br/>
            Non-reference = In-person or Hybrid. In-person fosters direct mentorship, Hybrid mixes both.
          </div>
        </div>
        <div class="attribute-content">
          <h4>Delivery Method</h4>
          <p>Online, in-person, or hybrid approaches.</p>
        </div>
      </div>

      <!-- Accreditation -->
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon">
          <svg width="24" height="24" fill="#27ae60" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#27ae60" stroke-width="2" fill="none"/>
            <path d="M12 6v6l4 2" stroke="#27ae60" stroke-width="2" fill="none"/>
          </svg>
          <div class="tooltip" role="tooltip">
            <strong>Reference: None</strong><br/>
            Non-reference = National or International. Accreditation fosters official recognition, potentially improving job prospects.
          </div>
        </div>
        <div class="attribute-content">
          <h4>Accreditation</h4>
          <p>None, National, or International endorsements.</p>
        </div>
      </div>

      <!-- Location -->
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon">
          <svg width="24" height="24" fill="#8e44ad" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#8e44ad" stroke-width="2" fill="none"/>
            <path d="M8 12h8M12 8v8" stroke="#8e44ad" stroke-width="2" fill="none"/>
          </svg>
          <div class="tooltip" role="tooltip">
            <strong>Reference: District-level</strong><br/>
            Non-reference = State-level or Regional. 
            Higher-level training sites might enhance coverage but possibly reduce local convenience.
          </div>
        </div>
        <div class="attribute-content">
          <h4>Location</h4>
          <p>District-level, state-level, or regional centers.</p>
        </div>
      </div>

      <!-- Training Level -->
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon">
          <svg width="24" height="24" fill="#3498db" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#3498db" stroke-width="2" fill="none"/>
            <path d="M12 6v6l4 2" stroke="#3498db" stroke-width="2" fill="none"/>
          </svg>
          <div class="tooltip" role="tooltip">
            <strong>Reference: Intermediate</strong><br/>
            Non-reference = Frontline or Advanced. 
            Frontline focuses local, day-to-day public health tasks. Advanced handles more complex or leadership roles.
          </div>
        </div>
        <div class="attribute-content">
          <h4>Training Level</h4>
          <p>Frontline, Intermediate, or Advanced tier FETP.</p>
        </div>
      </div>

      <!-- Cohort Size -->
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon">
          <svg width="24" height="24" fill="#e74c3c" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#e74c3c" stroke-width="2" fill="none"/>
            <path d="M8 12l2-2 4 4 6-6" stroke="#e74c3c" stroke-width="2" fill="none"/>
          </svg>
          <div class="tooltip" role="tooltip">
            Cohort size: from 200 to 1500 participants. Larger cohorts might expand coverage but also require more resources.
          </div>
        </div>
        <div class="attribute-content">
          <h4>Cohort Size</h4>
          <p>The number of participants per FETP intake.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Inputs Tab -->
  <section id="inputsTab" class="tabcontent" tabindex="0">
    <div class="input-card">
      <h2>Configure FETP Attributes</h2>
      <p>Select a training level, location, accreditation, and delivery method. 
         Adjust cost and cohort size. Then click "Calculate &amp; View Results." 
         All fields are mandatory except references (which do not appear). 
      </p>
      <form onsubmit="event.preventDefault();">
        <div class="input-cards">
          <!-- Training Level (no radio for Intermediate => reference) -->
          <div class="input-level-card">
            <h3>Training Level <span class="reference">(Ref: Intermediate)</span></h3>
            <div class="options">
              <label>
                <input type="radio" name="trainingLevel" id="frontlineCheck" value="frontline" />
                Frontline FETP
              </label>
              <label>
                <input type="radio" name="trainingLevel" id="advancedCheck" value="advanced" />
                Advanced FETP
              </label>
            </div>
          </div>
          <!-- Delivery Method (Ref=Online) -->
          <div class="input-level-card">
            <h3>Delivery Method <span class="reference">(Ref: Online)</span></h3>
            <div class="options">
              <label>
                <input type="radio" name="deliveryMethod" id="inpersonCheck" value="inperson" />
                In-person
              </label>
              <label>
                <input type="radio" name="deliveryMethod" id="hybridCheck" value="hybrid" />
                Hybrid
              </label>
            </div>
          </div>
          <!-- Accreditation (Ref=None) -->
          <div class="input-level-card">
            <h3>Accreditation <span class="reference">(Ref: None)</span></h3>
            <div class="options">
              <label>
                <input type="radio" name="accreditation" id="nationalCheck" value="national" />
                National
              </label>
              <label>
                <input type="radio" name="accreditation" id="internationalCheck" value="international" />
                International
              </label>
            </div>
          </div>
          <!-- Location (Ref=District) -->
          <div class="input-level-card">
            <h3>Location <span class="reference">(Ref: District-level)</span></h3>
            <div class="options">
              <label>
                <input type="radio" name="locationFETP" id="stateCheck" value="state" />
                State-Level
              </label>
              <label>
                <input type="radio" name="locationFETP" id="regionalCheck" value="regional" />
                Regional Centers
              </label>
            </div>
          </div>
          <!-- Cohort Size slider: 200..1500 step=100, default=500 -->
          <div class="input-level-card">
            <h3>Cohort Size (participants)</h3>
            <div class="options slider-option">
              <label for="cohortSlider">
                <i class="fa-solid fa-users"></i>
                <span id="cohortLabel">500</span>
              </label>
              <input type="range" id="cohortSlider" min="200" max="1500" step="100" value="500" oninput="updateCohortDisplay(this.value)" />
            </div>
          </div>
          <!-- Cost slider: 0..100 => used in formula -->
          <div class="input-level-card">
            <h3>Cost per Participant (USD)</h3>
            <div class="options slider-option">
              <label for="costSliderFETP">
                <i class="fa-solid fa-dollar-sign"></i>
                <span id="costLabelFETP">50</span>
              </label>
              <input type="range" id="costSliderFETP" min="0" max="100" step="1" value="50" oninput="updateFETPCostDisplay(this.value)" />
            </div>
          </div>
        </div>
        <div class="buttons-row">
          <button type="button" onclick="openFETPScenario()">Calculate &amp; View Results</button>
        </div>
      </form>
    </div>
    <!-- Modal for Results -->
    <div id="resultModal" class="modal">
      <div class="modal-content">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <div id="modalResults"></div>
      </div>
    </div>
  </section>

  <!-- WTP Results Tab -->
  <section id="wtpTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>Willingness-to-Pay (WTP) Results</h4>
      <p>
        The willingness-to-pay (WTP) for each FETP attribute is calculated by taking the ratio 
        of the attribute’s coefficient over the negative of the cost coefficient. 
        Hover over bars to see standard errors. Negative bars indicate a deterrent for uptake.
      </p>
      <div class="buttons-row">
        <button onclick="renderWTPChart()">Show WTP Charts</button>
      </div>
      <div class="chart-grid">
        <div class="chart-box" style="height: 350px; overflow:hidden;">
          <h3>WTP (USD)</h3>
          <canvas id="wtpChartMain"></canvas>
        </div>
      </div>
    </div>
  </section>

  <!-- Predicted Programme Uptake Tab -->
  <section id="probTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>Predicted Programme Uptake</h4>
      <p>
        Click “Show Probability Plot” to see the predicted FETP uptake (doughnut chart). 
        If the predicted uptake is under 30%, consider lowering cost or selecting 
        more appealing training/accreditation.
      </p>
      <div class="buttons-row">
        <button onclick="renderFETPProbChart()">Show Probability Plot</button>
      </div>
      <div class="chart-grid">
        <div class="chart-box" style="height: 350px; overflow:hidden;">
          <h3>Uptake Probability</h3>
          <canvas id="probChartFETP"></canvas>
        </div>
      </div>
    </div>
  </section>

  <!-- Costs & Benefits Tab -->
  <section id="costsTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>Costs &amp; Benefits Analysis</h4>
      <p>
        This analysis uses your scenario’s cost and cohort size to estimate total training costs, 
        plus QALY-based monetised benefits (assuming $50,000 per QALY).
      </p>
      <div class="qaly-selector">
        <label for="qalyFETPSelect">Select QALY Gain Scenario:</label>
        <select id="qalyFETPSelect" onchange="renderFETPCostsBenefits()">
          <option value="low">Low (0.01 QALYs)</option>
          <option value="moderate" selected>Moderate (0.05 QALYs)</option>
          <option value="high">High (0.08 QALYs)</option>
        </select>
      </div>
      <div id="costsFETPResults">
        <!-- dynamic cost–benefit summary & chart inserted here -->
      </div>
      <div class="modelling-assumptions">
        <h3><i class="fa-solid fa-lightbulb"></i> Assumptions</h3>
        <p>
          The cost function is simplified for demonstration. You can refine cost items 
          in “Cost Breakdown” or QALY logic in “Benefits Analysis.” 
        </p>
      </div>
      <div class="cost-icons">
        <button class="buttons-row" onclick="toggleFETPCostBreakdown()">Cost Breakdown</button>
        <button class="buttons-row" onclick="toggleFETPBenefitsAnalysis()">Benefits Analysis</button>
      </div>
      <div id="detailedFETPCostBreakdown" class="cost-cards" style="display:none;">
        <div class="cost-card">
          <h4><i class="fa-solid fa-newspaper"></i> Local Press Ads</h4>
          <p><strong>Unit Cost:</strong> $1,500</p>
          <p><strong>Quantity:</strong> 2</p>
          <p><strong>Total:</strong> $3,000</p>
        </div>
        <!-- Expand as needed -->
      </div>
      <div id="detailedFETPBenefitsAnalysis" class="cost-cards" style="display:none;">
        <div class="cost-card">
          <h4><i class="fa-solid fa-hand-holding-dollar"></i> QALY Benefits (FETP Context)</h4>
          <p>Calculated as: Participants × QALY per participant × $50,000.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Scenarios Tab -->
  <section id="scenariosTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>Saved Scenarios</h4>
      <p>
        Each scenario includes attribute choices plus the computed predicted uptake and net benefit. 
        You can export all saved scenarios to PDF.
      </p>
      <div class="buttons-row">
        <button onclick="saveFETPScenario()">Save Current Scenario</button>
        <button onclick="exportFETPComparison()">Compare &amp; Export PDF</button>
      </div>
      <div class="table-container">
        <table id="FETPScenarioTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Cost (USD)</th>
              <th>Delivery Method</th>
              <th>Accreditation</th>
              <th>Location</th>
              <th>Training Level</th>
              <th>Cohort</th>
              <th>Uptake (%)</th>
              <th>Net Benefit (USD)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <footer>
    <p>&copy; 2025 FETP Decision Aid. All Rights Reserved.<br/>Mesfin Genie, Newcastle Business School, The University of Newcastle, Australia</p>
  </footer>
</div>
<script src="script.js"></script>
</body>
</html>
