<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>STEPS Decision Aid Tool</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-papNMzNnQn5iH+1G+FHu8SyuXHs6A1k+Ln7tK5qRo1l5eYm6Jzv+1pArJ7N4C9FfpRrmAgM3tYWd3FZ9jKz1Bw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>STEPS Decision Aid Tool</h1>
      <p>
        This tool supports decision makers in planning and scaling Field Epidemiology Training Programs (FETP) in India by predicting programme uptake, performing detailed cost–benefit analysis, and evaluating willingness‐to‐pay (WTP) for key features—all in USD.
      </p>
      <div class="vertical-line"></div>
    </header>

    <nav class="tabs" role="tablist">
      <button class="tablink active" role="tab" aria-selected="true" aria-controls="introTab" onclick="openTab('introTab', this)">
        <i class="fa-solid fa-info-circle"></i><span> Introduction</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="instructionsTab" onclick="openTab('instructionsTab', this)">
        <i class="fa-solid fa-circle-question"></i><span> Instructions</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="attributesTab" onclick="openTab('attributesTab', this)">
        <i class="fa-solid fa-list"></i><span> Attributes</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="inputsTab" onclick="openTab('inputsTab', this)">
        <i class="fa-solid fa-sliders"></i><span> Inputs</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="wtpTab" onclick="openTab('wtpTab', this)">
        <i class="fa-solid fa-chart-bar"></i><span> WTP Results</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="uptakeTab" onclick="openTab('uptakeTab', this)">
        <i class="fa-solid fa-chart-line"></i><span> Predicted Program Uptake</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="cbaTab" onclick="openTab('cbaTab', this)">
        <i class="fa-solid fa-calculator"></i><span> Costs & Benefits</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="scenariosTab" onclick="openTab('scenariosTab', this)">
        <i class="fa-solid fa-folder-open"></i><span> Scenarios</span>
      </button>
    </nav>

    <!-- Introduction Tab -->
    <section id="introTab" class="tabcontent" tabindex="0" style="display: block;">
      <div class="card">
        <h2>Introduction</h2>
        <p>
          <strong>STEPS</strong> converts technical inputs into clear, actionable insights. It predicts participant uptake, computes cost–benefit outcomes, and evaluates the extra value (WTP) that training programme features provide.
        </p>
        <div class="vertical-line"></div>
        <ul>
          <li><strong>Instructions</strong>: Step-by-step guidance.</li>
          <li><strong>Attributes</strong>: Review training programme features with icons and tooltips showing reference levels.</li>
          <li><strong>Inputs</strong>: Configure your scenario using intuitive input cards.</li>
          <li><strong>WTP Results</strong>: View a narrow bar chart of extra value (in USD) for each non-reference attribute level.</li>
          <li><strong>Predicted Program Uptake</strong>: See the estimated participation rate with tailored recommendations.</li>
          <li><strong>Costs & Benefits</strong>: Detailed analysis with cost charts, summary tables, and individual cost cards.</li>
          <li><strong>Scenarios</strong>: Save, compare, and export your configurations.</li>
        </ul>
      </div>
    </section>

    <!-- Instructions Tab -->
    <section id="instructionsTab" class="tabcontent" tabindex="0">
      <div class="card calculation-info">
        <h4>How to Use This Tool</h4>
        <div class="vertical-line"></div>
        <ol>
          <li>Review the <strong>Attributes</strong> tab to learn about each training programme feature. Hover over an icon to see its detailed description and reference level.</li>
          <li>In the <strong>Inputs</strong> tab, configure your scenario using input cards. Only non‑reference options are selectable while the reference (benchmark) is displayed.</li>
          <li>Click <strong>"Calculate & View Results"</strong> to open a popup modal summarizing predicted uptake and recommendations. The full uptake chart appears in the Predicted Program Uptake tab.</li>
          <li>Examine the <strong>WTP Results</strong> tab to view a narrow bar chart for each non‑reference attribute level.</li>
          <li>Review the <strong>Costs & Benefits</strong> tab to see a dynamic summary (with QALY gain selector) plus a bar chart and detailed cost component cards.</li>
          <li>Save your scenario in the <strong>Scenarios</strong> tab to compare configurations or export a PDF report.</li>
        </ol>
      </div>
    </section>

    <!-- Attributes Tab -->
    <section id="attributesTab" class="tabcontent" tabindex="0">
      <h2>Key Attributes</h2>
      <div class="attributes-list">
        <!-- Attribute Card 1: Training Level -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="24" height="24" fill="#2980b9" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#2980b9" stroke-width="2" fill="none"/>
              <path d="M10 15l-3-3 1.4-1.4 1.6 1.6L15 7l1.4 1.4-6.4 6.4z" fill="#2980b9"/>
            </svg>
            <div class="tooltip" role="tooltip">
              <strong>Reference: Advanced</strong><br/>Options: Frontline, Intermediate, Advanced.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Training Level</h4>
            <p>Frontline, Intermediate, Advanced</p>
          </div>
        </div>
        <!-- Attribute Card 2: Delivery Method -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="24" height="24" fill="#8e44ad" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#8e44ad" stroke-width="2" fill="none"/>
              <path d="M8 12h8M12 8v8" stroke="#8e44ad" stroke-width="2" fill="none"/>
            </svg>
            <div class="tooltip" role="tooltip">
              <strong>Reference: Online</strong><br/>Options: In-Person, Online, Hybrid.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Delivery Method</h4>
            <p>In-Person, Online, Hybrid</p>
          </div>
        </div>
        <!-- Attribute Card 3: Accreditation -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="24" height="24" fill="#27ae60" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#27ae60" stroke-width="2" fill="none"/>
              <path d="M12 4v16" stroke="#27ae60" stroke-width="2" fill="none"/>
            </svg>
            <div class="tooltip" role="tooltip">
              <strong>Reference: None</strong><br/>Options: National, International, None.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Accreditation</h4>
            <p>National, International, None</p>
          </div>
        </div>
        <!-- Attribute Card 4: Location -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="24" height="24" fill="#e67e22" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#e67e22" stroke-width="2" fill="none"/>
              <path d="M12 4a8 8 0 0 1 0 16 8 8 0 0 1 0-16z" fill="#e67e22"/>
            </svg>
            <div class="tooltip" role="tooltip">
              <strong>Reference: District-Level</strong><br/>Options: District-Level, State-Level, Regional Centers.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Location</h4>
            <p>District-Level, State-Level, Regional Centers</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Inputs Tab -->
    <section id="inputsTab" class="tabcontent" tabindex="0">
      <h2>Configure Your Scenario</h2>
      <div class="input-card">
        <h3>Programme Inputs</h3>
        <p>Select your desired non‑reference options below, and adjust the sliders.</p>
        <div class="form-grid">
          <!-- Categorical Input Cards (only non-reference options) -->
          <div class="input-summary-card">
            <h4>Training Level <span class="reference">[Reference: Advanced]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="training-level" value="Frontline" checked> Frontline</label>
              <label><input type="radio" name="training-level" value="Intermediate"> Intermediate</label>
            </div>
          </div>
          <div class="input-summary-card">
            <h4>Delivery Method <span class="reference">[Reference: Online]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="delivery-method" value="In-Person" checked> In-Person</label>
              <label><input type="radio" name="delivery-method" value="Hybrid"> Hybrid</label>
            </div>
          </div>
          <div class="input-summary-card">
            <h4>Accreditation <span class="reference">[Reference: None]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="accreditation" value="National" checked> National</label>
              <label><input type="radio" name="accreditation" value="International"> International</label>
            </div>
          </div>
          <div class="input-summary-card">
            <h4>Location <span class="reference">[Reference: District-Level]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="location" value="State-Level" checked> State-Level</label>
              <label><input type="radio" name="location" value="Regional Centers"> Regional Centers</label>
            </div>
          </div>
          <!-- Continuous Inputs -->
          <div class="input-summary-card">
            <h4>Cohort Size</h4>
            <input type="range" class="form-control-range" id="cohort-size" min="500" max="2000" step="250" value="1000">
            <small id="cohort-size-value">1000</small>
          </div>
          <div class="input-summary-card">
            <h4>Cost per Participant (USD)</h4>
            <input type="range" class="form-control-range" id="cost-per-participant" min="500" max="6000" step="100" value="3000">
            <small id="cost-per-participant-value">$3,000</small>
          </div>
        </div>
        <div class="buttons-row">
          <button type="button" class="btn btn-primary" id="view-results">
            Calculate & View Results
          </button>
          <div id="calc-feedback" class="calc-feedback"></div>
        </div>
      </div>
    </section>

    <!-- Modal for Results -->
    <div id="resultsModal" class="modal">
      <div class="modal-content">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <h3>Calculation Results</h3>
        <div id="modal-results">
          <!-- Results injected by script -->
        </div>
      </div>
    </div>

    <!-- Predicted Program Uptake Tab -->
    <section id="uptakeTab" class="tabcontent" tabindex="0">
      <h2>Predicted Program Uptake</h2>
      <div id="uptake-content">
        <div class="chart-box">
          <canvas id="uptakeChart"></canvas>
        </div>
        <div id="uptake-recommendation" class="recommendation"></div>
      </div>
    </section>

    <!-- WTP Results Tab -->
    <section id="wtpTab" class="tabcontent" tabindex="0">
      <div class="calculation-info">
        <h4>Willingness to Pay (WTP) Results</h4>
        <p>
          WTP is calculated as the difference between an attribute level’s coefficient and its baseline divided by the (negative) cost coefficient, then scaled by 1000 to yield a USD value. Only non-reference levels are plotted.
        </p>
        <div class="chart-box">
          <canvas id="wtpChartMain"></canvas>
        </div>
      </div>
    </section>

    <!-- Costs & Benefits Tab -->
    <section id="cbaTab" class="tabcontent" tabindex="0">
      <div id="cba-content" class="calculation-info">
        <h4>Costs & Benefits Analysis</h4>
        <p>
          Total costs = (Cohort Size × Training Cost). Fixed costs include local press ads, printing, postage, administrative personnel, trainer fees, on‑costs, and facilitator salaries. Variable costs include material costs, venue hire, session time, and travel. Benefits are estimated from QALY gains (assumed 0.05 per participant) multiplied by $50,000 per QALY.
        </p>
        <div class="qaly-selector">
          <label for="qalySelect">Select QALY Gain Scenario:</label>
          <select id="qalySelect">
            <option value="low">Low (0.02 QALYs)</option>
            <option value="moderate" selected>Moderate (0.05 QALYs)</option>
            <option value="high">High (0.1 QALYs)</option>
          </select>
        </div>
        <div class="dynamic-summary" id="cba-summary">
          <!-- Dynamic summary table will be injected here -->
        </div>
        <div class="chart-box">
          <canvas id="cbaChart"></canvas>
        </div>
        <div class="detailed-info">
          <h4>Detailed Cost Components</h4>
          <div class="cost-cards">
            <div class="cost-card">
              <h4><i class="fa-solid fa-newspaper"></i> Local Press Ads</h4>
              <p><strong>Unit Cost:</strong> $1,500</p>
              <p><strong>Quantity:</strong> 2</p>
              <p><strong>Total:</strong> $3,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-print"></i> Printing of Leaflets</h4>
              <p><strong>Unit Cost:</strong> $0.12</p>
              <p><strong>Quantity:</strong> 10,000</p>
              <p><strong>Total:</strong> $1,200</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-envelope"></i> Postage of Leaflets</h4>
              <p><strong>Unit Cost:</strong> $0.15</p>
              <p><strong>Quantity:</strong> 10,000</p>
              <p><strong>Total:</strong> $1,500</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-user"></i> Administrative Personnel</h4>
              <p><strong>Unit Cost:</strong> $50</p>
              <p><strong>Quantity:</strong> 10</p>
              <p><strong>Total:</strong> $500</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-chalkboard-teacher"></i> Trainer Cost (5-hour sessions)</h4>
              <p><strong>Unit Cost:</strong> $223.86</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $22,386</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-percent"></i> On-Costs (30%)</h4>
              <p><strong>Unit Cost:</strong> $44.77</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $4,477</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-user-tie"></i> Facilitator Salaries</h4>
              <p><strong>Unit Cost:</strong> $100</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $10,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-box"></i> Material Costs</h4>
              <p><strong>Unit Cost:</strong> $50</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $5,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-building"></i> Venue Hire</h4>
              <p><strong>Unit Cost:</strong> $15</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $1,500</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-clock"></i> Session Time Cost</h4>
              <p><strong>Unit Cost:</strong> $20</p>
              <p><strong>Quantity:</strong> 250</p>
              <p><strong>Total:</strong> $5,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-road"></i> Travel Costs</h4>
              <p><strong>Unit Cost:</strong> $10</p>
              <p><strong>Quantity:</strong> 250</p>
              <p><strong>Total:</strong> $2,500</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Scenarios Tab -->
    <section id="scenariosTab" class="tabcontent" tabindex="0">
      <div class="calculation-info">
        <h4>Saved Scenarios</h4>
        <p>
          Your saved scenarios appear below. Each scenario shows all selected inputs along with predicted uptake and net benefit.
        </p>
        <div class="buttons-row">
          <button class="btn btn-info" id="save-scenario">Save Current Scenario</button>
          <button class="btn btn-secondary" id="export-pdf">Export Scenarios to PDF</button>
        </div>
        <div class="scenario-list" id="saved-scenarios-list">
          <!-- Scenario list will be injected by script -->
        </div>
      </div>
    </section>

    <footer>
      <p>
        &copy; 2025 STEPS. All Rights Reserved.<br />
        Mesfin Genie, Newcastle Business School, University of Newcastle, Australia<br />
        <strong>Support:</strong> <a href="mailto:mesfin.genie@newcastle.edu.au">mesfin.genie@newcastle.edu.au</a>
      </p>
    </footer>
  </div>

  <!-- Modal for Results -->
  <div id="resultsModal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeModal()">&times;</span>
      <h3>Calculation Results</h3>
      <div id="modal-results">
        <!-- Results injected by script -->
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
