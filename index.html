<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>STEPS Decision Aid Tool</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-papNMzNnQn5iH+1G+FHu8SyuXHs6A1k+Ln7tK5qRo1l5eYm6Jzv+1pArJ7N4C9FfpRrmAgM3tYWd3FZ9jKz1Bw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>STEPS Decision Aid Tool</h1>
      <p>
        This tool helps decision makers plan and scale Field Epidemiology Training Programs (FETP) in India by predicting programme uptake, performing cost–benefit analyses, and evaluating willingness‐to‐pay (WTP) for six key attributes (all in USD).
      </p>
      <hr class="intro-hr" />
    </header>

    <nav class="tabs" role="tablist">
      <button class="tablink active" role="tab" aria-selected="true" aria-controls="introTab" onclick="openTab('introTab', this)">
        <i class="fa-solid fa-info-circle"></i><span> Introduction</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="instructionsTab" onclick="openTab('instructionsTab', this)">
        <i class="fa-solid fa-circle-question"></i><span> Instructions</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="attributesTab" onclick="openTab('attributesTab', this)">
        <i class="fa-solid fa-list"></i><span> Attributes</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="inputsTab" onclick="openTab('inputsTab', this)">
        <i class="fa-solid fa-sliders"></i><span> Inputs</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="wtpTab" onclick="openTab('wtpTab', this)">
        <i class="fa-solid fa-chart-bar"></i><span> WTP Results</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="uptakeTab" onclick="openTab('uptakeTab', this)">
        <i class="fa-solid fa-chart-line"></i><span> Predicted Program Uptake</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="cbaTab" onclick="openTab('cbaTab', this)">
        <i class="fa-solid fa-calculator"></i><span> Costs &amp; Benefits</span>
      </button>
      <button class="tablink" role="tab" aria-selected="false" aria-controls="scenariosTab" onclick="openTab('scenariosTab', this)">
        <i class="fa-solid fa-folder-open"></i><span> Scenarios</span>
      </button>
    </nav>

    <!-- Introduction Tab -->
    <section id="introTab" class="tabcontent" tabindex="0" style="display: block;">
      <div class="card">
        <h2>Introduction</h2>
        <ul class="intro-list">
          <li><strong>Instructions</strong>: Step-by-step guidance on usage.</li>
          <li><strong>Attributes</strong>: Overview of six attributes with reference baselines and helpful icons.</li>
          <li><strong>Inputs</strong>: Select non-reference levels for the four discrete attributes; adjust two sliders for Cohort Size and Cost per Participant.</li>
          <li><strong>WTP Results</strong>: A bar chart of extra value for each non-reference level (including continuous attributes now).</li>
          <li><strong>Predicted Program Uptake</strong>: Estimated uptake chart with scenario-specific suggestions.</li>
          <li><strong>Costs &amp; Benefits</strong>: Dynamic summary, QALY scenario selection, bar chart, cost breakdown cards.</li>
          <li><strong>Scenarios</strong>: Save, compare, or export your configurations in PDF.</li>
        </ul>
      </div>
    </section>

    <!-- Instructions Tab -->
    <section id="instructionsTab" class="tabcontent" tabindex="0">
      <div class="card calculation-info">
        <h4>How to Use This Tool</h4>
        <hr class="intro-hr" />
        <ol class="instructions-list">
          <li>Review the <strong>Attributes</strong> tab for reference baselines and info icons.</li>
          <li>In the <strong>Inputs</strong> tab, select only non-reference levels for Training Level, Delivery Method, Accreditation, and Location. Adjust <em>Cohort Size</em> and <em>Cost per Participant</em> sliders from their baseline (1000 and 3000 USD).</li>
          <li>Click <strong>"Calculate &amp; View Results"</strong> for a summary of predicted uptake. The <strong>Predicted Program Uptake</strong> tab displays a doughnut chart.</li>
          <li><strong>WTP Results</strong> shows the bar chart for non-reference discrete levels, plus computed WTP for 1-unit changes in Cohort Size and Cost per Participant relative to their baselines.</li>
          <li><strong>Costs &amp; Benefits</strong> integrates the user scenario with a QALY scenario selector, summary table, bar chart, and cost breakdown cards.</li>
          <li><strong>Scenarios</strong> can be saved, loaded, or exported to PDF. Each scenario includes all chosen attributes, predicted uptake, and net benefit.</li>
        </ol>
      </div>
    </section>

    <!-- Attributes Tab -->
    <section id="attributesTab" class="tabcontent" tabindex="0">
      <h2>Key Attributes</h2>
      <div class="attributes-list">
        <!-- 1: Training Level -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <i class="fa-solid fa-user-graduate" style="color:#2980b9;font-size:1.7em;"></i>
            <div class="tooltip" role="tooltip" style="font-size:0.85em;">
              <strong>Reference:</strong> Advanced<br/>
              Non-reference: Frontline, Intermediate
            </div>
          </div>
          <div class="attribute-content">
            <h4>Training Level</h4>
            <p>Frontline, Intermediate, Advanced</p>
          </div>
        </div>
        <!-- 2: Delivery Method -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <i class="fa-solid fa-laptop-house" style="color:#8e44ad;font-size:1.7em;"></i>
            <div class="tooltip" role="tooltip" style="font-size:0.85em;">
              <strong>Reference:</strong> Online<br/>
              Non-reference: In-Person, Hybrid
            </div>
          </div>
          <div class="attribute-content">
            <h4>Delivery Method</h4>
            <p>In-Person, Online, Hybrid</p>
          </div>
        </div>
        <!-- 3: Accreditation -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <i class="fa-solid fa-certificate" style="color:#27ae60;font-size:1.7em;"></i>
            <div class="tooltip" role="tooltip" style="font-size:0.85em;">
              <strong>Reference:</strong> None<br/>
              Non-reference: National, International
            </div>
          </div>
          <div class="attribute-content">
            <h4>Accreditation</h4>
            <p>National, International, None</p>
          </div>
        </div>
        <!-- 4: Location -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <i class="fa-solid fa-location-dot" style="color:#e67e22;font-size:1.7em;"></i>
            <div class="tooltip" role="tooltip" style="font-size:0.85em;">
              <strong>Reference:</strong> District-Level<br/>
              Non-reference: State-Level, Regional Centers
            </div>
          </div>
          <div class="attribute-content">
            <h4>Location</h4>
            <p>District-Level, State-Level, Regional Centers</p>
          </div>
        </div>
        <!-- 5: Cohort Size (continuous, baseline 1000) -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <i class="fa-solid fa-users-line" style="color:#3498db;font-size:1.7em;"></i>
            <div class="tooltip" role="tooltip" style="font-size:0.85em;">
              <strong>Baseline:</strong> 1000
            </div>
          </div>
          <div class="attribute-content">
            <h4>Cohort Size</h4>
            <p>A continuous attribute (slider 500–2000). Baseline is 1000.</p>
          </div>
        </div>
        <!-- 6: Cost per Participant -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <i class="fa-solid fa-dollar-sign" style="color:#e74c3c;font-size:1.7em;"></i>
            <div class="tooltip" role="tooltip" style="font-size:0.85em;">
              <strong>Baseline:</strong> 3000 USD
            </div>
          </div>
          <div class="attribute-content">
            <h4>Cost per Participant (USD)</h4>
            <p>A continuous attribute (slider 500–6000). Baseline is $3000.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Inputs Tab -->
    <section id="inputsTab" class="tabcontent" tabindex="0">
      <h2>Configure Your Scenario</h2>
      <div class="input-card">
        <h3>Programme Inputs</h3>
        <p>Select only non-reference levels for the four discrete attributes. Adjust the two sliders from their baselines (1000 for Cohort Size, $3000 for Cost).</p>
        <div class="form-grid">
          <!-- 1: Training Level (Ref: Advanced) -->
          <div class="input-summary-card">
            <h4>Training Level <span class="reference">[Ref: Advanced]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="training-level" value="Frontline" checked> Frontline</label>
              <label><input type="radio" name="training-level" value="Intermediate"> Intermediate</label>
            </div>
          </div>
          <!-- 2: Delivery Method (Ref: Online) -->
          <div class="input-summary-card">
            <h4>Delivery Method <span class="reference">[Ref: Online]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="delivery-method" value="In-Person" checked> In-Person</label>
              <label><input type="radio" name="delivery-method" value="Hybrid"> Hybrid</label>
            </div>
          </div>
          <!-- 3: Accreditation (Ref: None) -->
          <div class="input-summary-card">
            <h4>Accreditation <span class="reference">[Ref: None]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="accreditation" value="National" checked> National</label>
              <label><input type="radio" name="accreditation" value="International"> International</label>
            </div>
          </div>
          <!-- 4: Location (Ref: District-Level) -->
          <div class="input-summary-card">
            <h4>Location <span class="reference">[Ref: District-Level]</span></h4>
            <div class="radio-group">
              <label><input type="radio" name="location" value="State-Level" checked> State-Level</label>
              <label><input type="radio" name="location" value="Regional Centers"> Regional Centers</label>
            </div>
          </div>
          <!-- 5: Cohort Size slider -->
          <div class="input-summary-card">
            <h4>Cohort Size</h4>
            <input type="range" class="form-control-range" id="cohort-size" min="500" max="2000" step="250" value="1000">
            <small id="cohort-size-value">1000</small>
          </div>
          <!-- 6: Cost per Participant slider -->
          <div class="input-summary-card">
            <h4>Cost per Participant (USD)</h4>
            <input type="range" class="form-control-range" id="cost-per-participant" min="500" max="6000" step="100" value="3000">
            <small id="cost-per-participant-value">$3,000</small>
          </div>
        </div>
        <div class="buttons-row">
          <button type="button" class="btn btn-primary" id="view-results">
            Calculate &amp; View Results
          </button>
          <div id="calc-feedback" class="calc-feedback"></div>
        </div>
      </div>
    </section>

    <!-- Modal for Results -->
    <div id="resultsModal" class="modal">
      <div class="modal-content">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <h3>Calculation Results</h3>
        <div id="modal-results">
          <!-- Results from script.js -->
        </div>
      </div>
    </div>

    <!-- Predicted Program Uptake Tab -->
    <section id="uptakeTab" class="tabcontent" tabindex="0">
      <h2>Predicted Program Uptake</h2>
      <div id="uptake-content">
        <div class="chart-box">
          <canvas id="uptakeChart"></canvas>
        </div>
        <div id="uptake-recommendation" class="recommendation"></div>
      </div>
    </section>

    <!-- WTP Results Tab -->
    <section id="wtpTab" class="tabcontent" tabindex="0">
      <div class="calculation-info">
        <h4>Willingness to Pay (WTP) Results</h4>
        <p>
          This chart shows extra value (in USD) for each non-reference attribute level compared to its reference. 
          Continuous attributes (Cohort Size &amp; Cost/Participant) are included as +1 increments above baseline 
          (1000 for Cohort Size, $3000 for Cost).
        </p>
        <div class="chart-box">
          <canvas id="wtpChartMain"></canvas>
        </div>
      </div>
    </section>

    <!-- Costs & Benefits Tab -->
    <section id="cbaTab" class="tabcontent" tabindex="0">
      <div id="cba-content" class="calculation-info">
        <h4>Costs &amp; Benefits Analysis</h4>
        <p>
          Total costs = (Cohort Size × Training Cost). Benefits are derived from QALY gains (Low=0.02, Moderate=0.05, High=0.1) 
          multiplied by $50,000. Adjust the scenario in <strong>Inputs</strong>, then revisit here to see updated details.
        </p>
        <div class="qaly-selector">
          <label for="qalySelect">Select QALY Gain Scenario:</label>
          <select id="qalySelect" onchange="renderCostsBenefits()">
            <option value="low">Low (0.02 QALYs)</option>
            <option value="moderate" selected>Moderate (0.05 QALYs)</option>
            <option value="high">High (0.1 QALYs)</option>
          </select>
        </div>
        <div class="dynamic-summary" id="cba-summary">
          <!-- Summary table from script.js -->
        </div>
        <div class="chart-box">
          <canvas id="cbaChart"></canvas>
        </div>
        <div class="detailed-info">
          <h4>Detailed Cost Components</h4>
          <div class="cost-cards">
            <div class="cost-card">
              <h4><i class="fa-solid fa-newspaper"></i> Local Press Ads</h4>
              <p><strong>Unit Cost:</strong> $1,500</p>
              <p><strong>Quantity:</strong> 2</p>
              <p><strong>Total:</strong> $3,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-print"></i> Printing of Leaflets</h4>
              <p><strong>Unit Cost:</strong> $0.12</p>
              <p><strong>Quantity:</strong> 10,000</p>
              <p><strong>Total:</strong> $1,200</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-envelope"></i> Postage of Leaflets</h4>
              <p><strong>Unit Cost:</strong> $0.15</p>
              <p><strong>Quantity:</strong> 10,000</p>
              <p><strong>Total:</strong> $1,500</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-user"></i> Administrative Personnel</h4>
              <p><strong>Unit Cost:</strong> $50</p>
              <p><strong>Quantity:</strong> 10</p>
              <p><strong>Total:</strong> $500</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-chalkboard-teacher"></i> Trainer Cost (5-hour sessions)</h4>
              <p><strong>Unit Cost:</strong> $223.86</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $22,386</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-percent"></i> On-Costs (30%)</h4>
              <p><strong>Unit Cost:</strong> $44.77</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $4,477</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-user-tie"></i> Facilitator Salaries</h4>
              <p><strong>Unit Cost:</strong> $100</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $10,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-box"></i> Material Costs</h4>
              <p><strong>Unit Cost:</strong> $50</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $5,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-building"></i> Venue Hire</h4>
              <p><strong>Unit Cost:</strong> $15</p>
              <p><strong>Quantity:</strong> 100</p>
              <p><strong>Total:</strong> $1,500</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-clock"></i> Session Time Cost</h4>
              <p><strong>Unit Cost:</strong> $20</p>
              <p><strong>Quantity:</strong> 250</p>
              <p><strong>Total:</strong> $5,000</p>
            </div>
            <div class="cost-card">
              <h4><i class="fa-solid fa-road"></i> Travel Costs</h4>
              <p><strong>Unit Cost:</strong> $10</p>
              <p><strong>Quantity:</strong> 250</p>
              <p><strong>Total:</strong> $2,500</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Scenarios Tab -->
    <section id="scenariosTab" class="tabcontent" tabindex="0">
      <div class="calculation-info">
        <h4>Saved Scenarios</h4>
        <p>
          Below are your saved scenarios, each with chosen inputs, predicted uptake, and net benefit. 
          You can load or delete them, or export them all to PDF.
        </p>
        <div class="buttons-row">
          <button class="btn btn-info" id="save-scenario">Save Current Scenario</button>
          <button class="btn btn-secondary" id="export-pdf">Export Scenarios to PDF</button>
        </div>
        <div class="scenario-list" id="saved-scenarios-list">
          <!-- scenario items from script.js -->
        </div>
      </div>
    </section>

    <footer>
      <p>
        &copy; 2025 STEPS. All Rights Reserved.<br />
        Mesfin Genie, Newcastle Business School, University of Newcastle, Australia<br />
        <strong>Support:</strong> <a href="mailto:mesfin.genie@newcastle.edu.au">mesfin.genie@newcastle.edu.au</a>
      </p>
    </footer>
  </div>

  <!-- Modal for Results -->
  <div id="resultsModal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeModal()">&times;</span>
      <h3>Calculation Results</h3>
      <div id="modal-results"></div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
