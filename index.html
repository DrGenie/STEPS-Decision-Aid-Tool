<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>FETP Decision Aid Tool</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-papNMzNnQn5iH+1G+FHu8SyuXHs6A1k+Ln7tK5qRo1l5eYm6Jzv+1pArJ7N4C9FfpRrmAgM3tYWd3FZ9jKz1Bw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>FETP Decision Aid Tool</h1>
      <p>This tool helps decision-makers plan and scale Field Epidemiology Training Programs (FETP) by predicting programme uptake, performing cost–benefit analyses, and evaluating willingness–to–pay for six key attributes in USD.</p>
    </header>

    <nav class="tabs" role="tablist">
      <button class="tablink active" data-tab="introTab" aria-selected="true">
        <i class="fa-solid fa-info-circle"></i><span> Introduction</span>
      </button>
      <button class="tablink" data-tab="instructionsTab" aria-selected="false">
        <i class="fa-solid fa-circle-question"></i><span> Instructions</span>
      </button>
      <button class="tablink" data-tab="attributesTab" aria-selected="false">
        <i class="fa-solid fa-list"></i><span> Attributes</span>
      </button>
      <button class="tablink" data-tab="inputsTab" aria-selected="false">
        <i class="fa-solid fa-sliders"></i><span> Inputs</span>
      </button>
      <button class="tablink" data-tab="wtpTab" aria-selected="false">
        <i class="fa-solid fa-chart-bar"></i><span> WTP Results</span>
      </button>
      <button class="tablink" data-tab="probTab" aria-selected="false">
        <i class="fa-solid fa-chart-pie"></i><span> Predicted Programme Uptake</span>
      </button>
      <button class="tablink" data-tab="costsTab" aria-selected="false">
        <i class="fa-solid fa-calculator"></i><span> Costs &amp; Benefits</span>
      </button>
      <button class="tablink" data-tab="scenariosTab" aria-selected="false">
        <i class="fa-solid fa-folder-open"></i><span> Saved Scenarios</span>
      </button>
    </nav>

    <!-- Introduction Tab -->
    <section id="introTab" class="tabcontent" tabindex="0" style="display: block;">
      <div class="intro-box">
        <p>
          In many countries, Field Epidemiology Training Programs (FETPs) are essential for rapidly detecting and responding to public health threats. This decision aid uses discrete choice experiment (DCE) estimates to predict uptake probabilities, enabling data-driven decisions on how best to configure FETP attributes.
        </p>
        <ul>
          <li><strong>Instructions</strong> – Step-by-step guide to using the tool.</li>
          <li><strong>Attributes</strong> – Learn about six key features of FETP training (hover over icons for reference levels).</li>
          <li><strong>Inputs</strong> – Configure your scenario’s cost, training level, accreditation, location, etc.</li>
          <li><strong>WTP Results</strong> – Inspect willingness-to-pay (USD) for each attribute from the DCE.</li>
          <li><strong>Predicted Programme Uptake</strong> – View the predicted probability of uptake based on your scenario.</li>
          <li><strong>Costs &amp; Benefits</strong> – Explore cost components and QALY-based benefits, with interactive toggles for detailed breakdowns.</li>
          <li><strong>Saved Scenarios</strong> – Save multiple configurations, compare them, or export to PDF.</li>
        </ul>
      </div>
    </section>

    <!-- Instructions Tab -->
    <section id="instructionsTab" class="tabcontent" tabindex="0">
      <div class="calculation-info">
        <h4>How to Use This Tool</h4>
        <ol>
          <li style="margin-left: 20px;">Check the <strong>Attributes</strong> tab for a detailed explanation of each FETP training feature (hover icons to see references).</li>
          <li style="margin-left: 20px;">In <strong>Inputs</strong>, select each attribute’s non-reference level (Training, Delivery Method, Accreditation, Location, etc.). For cost, use the slider from 0–100, internally mapped to a relevant USD range.</li>
          <li style="margin-left: 20px;">Press “Calculate &amp; View Results” to estimate your scenario’s predicted uptake and net benefit. A pop-up modal displays the summary; you can further refine these in the <strong>Predicted Programme Uptake</strong> tab or <strong>Costs &amp; Benefits</strong> tab.</li>
          <li style="margin-left: 20px;">The <strong>WTP Results</strong> tab reveals how each attribute level compares to the reference in terms of willingness-to-pay (in USD).</li>
          <li style="margin-left: 20px;">The <strong>Scenarios</strong> tab allows you to save multiple configurations, compare them side-by-side, or export them in PDF.</li>
        </ol>
      </div>
    </section>

    <!-- Attributes Tab -->
    <section id="attributesTab" class="tabcontent" tabindex="0">
      <h2>FETP Key Attributes</h2>
      <div class="attributes-list">
        <!-- Attribute Card 1: Cost per Participant -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="24" height="24" fill="#2980b9" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#2980b9" stroke-width="2" fill="none"/>
              <path d="M10 15l-3-3 1.4-1.4 1.6 1.6L15 7l1.4 1.4-6.4 6.4z" fill="#2980b9"/>
            </svg>
            <div class="tooltip" role="tooltip">
              The out-of-pocket cost (in USD) per participant to implement FETP training.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Cost per Participant</h4>
            <p>Varies from a low cost scenario to a high cost scenario, covering training, mentoring, travel, etc.</p>
          </div>
        </div>
        <!-- Attribute Card 2: Delivery Method -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="24" height="24" fill="#e67e22" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#e67e22" stroke-width="2" fill="none"/>
              <path d="M12 4a8 8 0 0 1 0 16 8 8 0 0 1 0-16z" fill="#e67e22"/>
            </svg>
            <div class="tooltip" role="tooltip">
              <strong>Reference: Online</strong><br/>Non-reference includes In-person or Hybrid.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Delivery Method</h4>
            <p>Online, in-person, or hybrid (mix).</p>
          </div>
        </div>
        <!-- Attribute Card 3: Accreditation -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="24" height="24" fill="#27ae60" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#27ae60" stroke-width="2" fill="none"/>
              <path d="M12 6v6l4 2" stroke="#27ae60" stroke-width="2" fill="none"/>
            </svg>
            <div class="tooltip" role="tooltip">
              <strong>Reference: None</strong><br/>National or International accreditation can boost recognition.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Accreditation</h4>
            <p>None, National, or International endorsements.</p>
          </div>
        </div>
        <!-- Attribute Card 4: Location of Training -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="24" height="24" fill="#8e44ad" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#8e44ad" stroke-width="2" fill="none"/>
              <path d="M8 12h8M12 8v8" stroke="#8e44ad" stroke-width="2" fill="none"/>
            </svg>
            <div class="tooltip" role="tooltip">
              <strong>Reference: District-level</strong><br/>Non-reference: State-level or Regional.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Location</h4>
            <p>Where FETP courses primarily occur (district, state, regional).</p>
          </div>
        </div>
        <!-- Attribute Card 5: Training Level -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="24" height="24" fill="#3498db" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#3498db" stroke-width="2" fill="none"/>
              <path d="M12 6v6l4 2" stroke="#3498db" stroke-width="2" fill="none"/>
            </svg>
            <div class="tooltip" role="tooltip">
              <strong>Reference: Intermediate</strong><br/>Non-reference: Advanced or Frontline.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Training Level</h4>
            <p>Frontline, Intermediate, or Advanced FETP tiers.</p>
          </div>
        </div>
        <!-- Attribute Card 6: Cohort Size -->
        <div class="attribute-card" tabindex="0">
          <div class="attribute-icon">
            <svg width="24" height="24" fill="#e74c3c" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#e74c3c" stroke-width="2" fill="none"/>
              <path d="M8 12l2-2 4 4 6-6" stroke="#e74c3c" stroke-width="2" fill="none"/>
            </svg>
            <div class="tooltip" role="tooltip">
              A continuous measure: smaller vs. larger cohorts.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Cohort Size</h4>
            <p>The number of participants enrolled in each FETP intake.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Inputs Tab (Level Card Layout) -->
    <section id="inputsTab" class="tabcontent" tabindex="0">
      <div class="input-card">
        <h2>Configure FETP Attributes</h2>
        <p>Set your scenario by selecting cost, location, training level, etc. Then click "Calculate &amp; View Results."</p>
        <form onsubmit="event.preventDefault();">
          <div class="input-cards">
            <!-- Training Level -->
            <div class="input-level-card">
              <h3>Training Level <span class="reference">(Reference: Intermediate)</span></h3>
              <div class="options">
                <label>
                  <input type="radio" name="trainingLevel" id="frontlineCheck" value="frontline" />
                  Frontline FETP
                </label>
                <label>
                  <input type="radio" name="trainingLevel" id="intermediateCheck" value="intermediate" />
                  Intermediate FETP
                </label>
                <label>
                  <input type="radio" name="trainingLevel" id="advancedCheck" value="advanced" />
                  Advanced FETP
                </label>
              </div>
            </div>
            <!-- Delivery Method -->
            <div class="input-level-card">
              <h3>Delivery Method <span class="reference">(Reference: Online)</span></h3>
              <div class="options">
                <label>
                  <input type="radio" name="deliveryMethod" id="inpersonCheck" value="inperson" />
                  In-person
                </label>
                <label>
                  <input type="radio" name="deliveryMethod" id="hybridCheck" value="hybrid" />
                  Hybrid
                </label>
              </div>
            </div>
            <!-- Accreditation -->
            <div class="input-level-card">
              <h3>Accreditation <span class="reference">(Reference: None)</span></h3>
              <div class="options">
                <label>
                  <input type="radio" name="accreditation" id="nationalCheck" value="national" />
                  National
                </label>
                <label>
                  <input type="radio" name="accreditation" id="internationalCheck" value="international" />
                  International
                </label>
              </div>
            </div>
            <!-- Location -->
            <div class="input-level-card">
              <h3>Location <span class="reference">(Reference: District-level)</span></h3>
              <div class="options">
                <label>
                  <input type="radio" name="locationFETP" id="stateCheck" value="state" />
                  State-Level
                </label>
                <label>
                  <input type="radio" name="locationFETP" id="regionalCheck" value="regional" />
                  Regional Centers
                </label>
              </div>
            </div>
            <!-- Cohort Size (Slider) -->
            <div class="input-level-card">
              <h3>Cohort Size (participants)</h3>
              <div class="options slider-option">
                <label for="cohortSlider">
                  <i class="fa-solid fa-users"></i>
                  <span id="cohortLabel">100</span>
                </label>
                <input type="range" id="cohortSlider" min="0" max="200" step="10" value="100" oninput="updateCohortDisplay(this.value)" />
              </div>
            </div>
            <!-- Cost (Slider) -->
            <div class="input-level-card">
              <h3>Cost per Participant (USD)</h3>
              <div class="options slider-option">
                <label for="costSliderFETP">
                  <i class="fa-solid fa-dollar-sign"></i>
                  <span id="costLabelFETP">50</span>
                </label>
                <input type="range" id="costSliderFETP" min="0" max="100" step="1" value="50" oninput="updateFETPCostDisplay(this.value)" />
              </div>
            </div>
          </div>
          <div class="buttons-row">
            <button type="button" onclick="openFETPScenario()">Calculate &amp; View Results</button>
          </div>
        </form>
      </div>
      <!-- Modal Popup for Results -->
      <div id="resultModal" class="modal">
        <div class="modal-content">
          <span class="close-button" onclick="closeModal()">&times;</span>
          <div id="modalResults"></div>
        </div>
      </div>
    </section>

    <!-- WTP Results Tab -->
    <section id="wtpTab" class="tabcontent" tabindex="0">
      <div class="calculation-info">
        <h4>Willingness-to-Pay (WTP) Results</h4>
        <p>
          The willingness-to-pay (WTP) for each FETP attribute is calculated by taking the ratio of the attribute’s coefficient to the negative of the cost coefficient. Hover over the bars in the chart to view standard errors and p-values.
        </p>
        <div class="buttons-row">
          <button onclick="renderWTPChart()">Show WTP Charts</button>
        </div>
        <div class="chart-grid">
          <div class="chart-box">
            <h3>WTP (USD)</h3>
            <canvas id="wtpChartMain"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- Predicted Programme Uptake Tab -->
    <section id="probTab" class="tabcontent" tabindex="0">
      <div class="calculation-info">
        <h4>Predicted Programme Uptake</h4>
        <p>Click “Show Probability Plot” to compute the predicted FETP uptake. If the predicted uptake is too low, consider changing cost, training level, or location to boost acceptance.</p>
        <div class="buttons-row">
          <button onclick="renderFETPProbChart()">Show Probability Plot</button>
        </div>
        <div class="chart-grid">
          <div class="chart-box">
            <h3>Uptake Probability</h3>
            <canvas id="probChartFETP"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- Costs & Benefits Tab -->
    <section id="costsTab" class="tabcontent" tabindex="0">
      <div class="calculation-info">
        <h4>Costs &amp; Benefits Analysis</h4>
        <p>
          We compute total training costs and QALY-based benefits for sub-populations enrolling in FETP.
          Adjust the QALY scenario below:
        </p>
        <div class="qaly-selector">
          <label for="qalyFETPSelect">Select QALY Gain Scenario:</label>
          <select id="qalyFETPSelect" onchange="renderFETPCostsBenefits()">
            <option value="low">Low (0.01 QALYs)</option>
            <option value="moderate" selected>Moderate (0.05 QALYs)</option>
            <option value="high">High (0.08 QALYs)</option>
          </select>
        </div>
        <div id="costsFETPResults">
          <!-- dynamic summary & chart go here -->
        </div>
        <div class="modelling-assumptions">
          <h3><i class="fa-solid fa-lightbulb"></i> Assumptions</h3>
          <p>This analysis includes both fixed and variable cost elements, plus the QALY-based valuation at $50,000 per QALY. The cost structure can be toggled to show a detailed breakdown.</p>
        </div>
        <div class="cost-icons">
          <button class="buttons-row" onclick="toggleFETPCostBreakdown()">Cost Breakdown</button>
          <button class="buttons-row" onclick="toggleFETPBenefitsAnalysis()">Benefits Analysis</button>
        </div>
        <!-- Example toggled sections -->
        <div id="detailedFETPCostBreakdown" class="cost-cards" style="display:none;">
          <div class="cost-card">
            <h4><i class="fa-solid fa-newspaper"></i> Local Press Ads</h4>
            <p><strong>Unit Cost:</strong> $1,500</p>
            <p><strong>Quantity:</strong> 2</p>
            <p><strong>Total:</strong> $3,000</p>
          </div>
          <!-- More cost items as needed -->
        </div>
        <div id="detailedFETPBenefitsAnalysis" class="cost-cards" style="display:none;">
          <div class="cost-card">
            <h4><i class="fa-solid fa-hand-holding-dollar"></i> QALY Benefits (FETP Context)</h4>
            <p>Calculated as: Participants × QALY per participant × $50,000. This approach quantifies potential economic gains from improved outbreak detection & response.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Scenarios Tab -->
    <section id="scenariosTab" class="tabcontent" tabindex="0">
      <div class="calculation-info">
        <h4>Saved Scenarios</h4>
        <p>Below are your saved scenarios. Each includes attribute choices plus the computed predicted uptake and net benefit.</p>
        <div class="buttons-row">
          <button onclick="saveFETPScenario()">Save Current Scenario</button>
          <button onclick="exportFETPComparison()">Compare &amp; Export PDF</button>
        </div>
        <div class="table-container">
          <table id="FETPScenarioTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Cost (USD)</th>
                <th>Delivery Method</th>
                <th>Accreditation</th>
                <th>Location</th>
                <th>Training Level</th>
                <th>Cohort</th>
                <th>Uptake (%)</th>
                <th>Net Benefit (USD)</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <footer>
      <p>&copy; 2025 FETP Decision Aid. All Rights Reserved.<br />Mesfin Genie, Newcastle Business School, The University of Newcastle, Australia</p>
    </footer>
  </div>

  <script src="script.js"></script>
</body>
</html>
